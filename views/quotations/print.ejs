<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quotation #<%= quotation.quotationNumber %> - <%= quotation.customerInfo.name %></title>
    <style>
        /* Print-optimized styling */
        @media print {
            body { 
                margin: 0; 
                font-size: 10px;
                line-height: 1.2;
            }
            .no-print { display: none !important; }
            .print-break { page-break-after: always; }
            .invoice-container {
                border: none;
                box-shadow: none;
                margin: 0;
                padding: 0;
            }
        }
        
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 10px;
            background: white;
            color: #333;
            font-size: 11px;
            line-height: 1.3;
        }
        
        .invoice-container {
            max-width: 100%;
            margin: 0 auto;
            background: white;
            border: 1px solid #ddd;
        }
        
        .invoice-header {
            background: #f8f9fa;
            padding: 10px 15px;
            border-bottom: 2px solid #8b5cf6;
            text-align: center;
        }
        
        .company-name {
            font-size: 18px;
            font-weight: bold;
            color: #8b5cf6;
            margin-bottom: 3px;
        }
        
        .company-details {
            font-size: 10px;
            color: #666;
            line-height: 1.3;
        }
        
        .invoice-title {
            text-align: center;
            font-size: 16px;
            font-weight: bold;
            color: white;
            margin: 8px 0;
            text-transform: uppercase;
            letter-spacing: 1px;
            background: #8b5cf6;
            padding: 6px;
        }
        
        .quotation-details {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            padding: 10px 15px;
            border-bottom: 1px solid #eee;
        }
        
        .quotation-info, .customer-info {
            background: #f8f9fa;
            padding: 8px;
            border-radius: 3px;
        }
        
        .section-title {
            font-weight: bold;
            color: #8b5cf6;
            margin-bottom: 6px;
            font-size: 12px;
        }
        
        .info-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 4px;
            padding: 1px 0;
        }
        
        .info-label {
            font-weight: 500;
            color: #555;
            font-size: 10px;
        }
        
        .info-value {
            font-weight: bold;
            color: #333;
            font-size: 10px;
        }
        
        .items-section {
            padding: 10px 15px;
        }
        
        .items-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 10px;
            font-size: 9px;
        }
        
        .items-table th {
            background: #8b5cf6;
            color: white;
            padding: 6px 4px;
            text-align: left;
            font-weight: bold;
            border: 1px solid #8b5cf6;
            font-size: 9px;
        }
        
        .items-table td {
            padding: 4px 3px;
            border: 1px solid #ddd;
            vertical-align: top;
            font-size: 9px;
        }
        
        .items-table tbody tr:nth-child(even) {
            background: #f8f9fa;
        }
        
        .item-name {
            font-weight: bold;
            color: #333;
            font-size: 9px;
        }
        
        .item-details {
            font-size: 8px;
            color: #666;
            margin-top: 1px;
        }
        
        .amount-column {
            text-align: right;
            font-weight: bold;
            font-size: 9px;
        }
        
        .charges-section {
            margin-top: 10px;
        }
        
        .charges-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 10px;
            font-size: 9px;
        }
        
        .charges-table th {
            background: #6b7280;
            color: white;
            padding: 6px 4px;
            text-align: left;
            font-weight: bold;
            border: 1px solid #6b7280;
            font-size: 9px;
        }
        
        .charges-table td {
            padding: 4px;
            border: 1px solid #ddd;
            font-size: 9px;
        }
        
        .totals-section {
            background: #f8f9fa;
            padding: 10px 15px;
            border-top: 2px solid #8b5cf6;
        }
        
        .totals-table {
            width: 100%;
            max-width: 250px;
            margin-left: auto;
            font-size: 10px;
        }
        
        .totals-table td {
            padding: 4px 8px;
            border-bottom: 1px solid #ddd;
        }
        
        .total-label {
            font-weight: 500;
            color: #555;
            font-size: 10px;
        }
        
        .total-amount {
            font-weight: bold;
            text-align: right;
            color: #333;
            font-size: 10px;
        }
        
        .final-total {
            background: #8b5cf6;
            color: white;
            font-size: 12px;
            font-weight: bold;
        }
        
        .final-total td {
            padding: 6px 8px;
            border: none;
        }
        
        .terms-section {
            padding: 10px 15px;
            border-top: 1px solid #eee;
        }
        
        .terms-title {
            font-weight: bold;
            color: #8b5cf6;
            margin-bottom: 6px;
            font-size: 11px;
        }
        
        .terms-content {
            font-size: 9px;
            color: #666;
            line-height: 1.3;
        }
        
        .footer-section {
            padding: 10px 15px;
            border-top: 1px solid #eee;
            text-align: center;
        }
        
        .signature-area {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-top: 25px;
        }
        
        .signature-box {
            text-align: center;
            border-top: 1px solid #333;
            padding-top: 6px;
            font-size: 9px;
        }
        
        .print-controls {
            text-align: center;
            margin: 15px 0;
            padding: 8px;
            background: #f8f9fa;
            border-radius: 4px;
        }
        
        .print-btn {
            background: #8b5cf6;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            margin: 0 5px;
        }
        
        .print-btn:hover {
            background: #7c3aed;
        }
        
        .back-btn {
            background: #6b7280;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            margin: 0 5px;
            text-decoration: none;
            display: inline-block;
        }
        
        .back-btn:hover {
            background: #4b5563;
        }
        
        .validity-notice {
            background: #fef3c7;
            padding: 6px 10px;
            border-radius: 3px;
            margin: 8px 0;
            font-size: 9px;
            color: #92400e;
            border-left: 3px solid #f59e0b;
        }
        
        /* Compact spacing for print */
        h3, h4 {
            margin: 8px 0 6px 0;
            font-size: 11px;
        }
        
        /* More items per page */
        @media print {
            .items-table th,
            .items-table td {
                padding: 2px 3px;
                font-size: 8px;
            }
            
            .company-name {
                font-size: 16px;
            }
            
            .invoice-title {
                font-size: 14px;
                padding: 4px;
                margin: 6px 0;
            }
            
            .quotation-details {
                padding: 8px 12px;
                gap: 10px;
            }
            
            .items-section {
                padding: 8px 12px;
            }
            
            .totals-section {
                padding: 8px 12px;
            }
            
            .terms-section,
            .footer-section {
                padding: 8px 12px;
            }
            
            .signature-area {
                margin-top: 15px;
                gap: 20px;
            }
        }
        
        .expired-notice {
            background: #fee2e2;
            border: 1px solid #ef4444;
            color: #991b1b;
            border-radius: 3px;
            padding: 6px 10px;
            margin: 8px 0;
            text-align: center;
            font-weight: bold;
            font-size: 9px;
        }
    </style>
</head>
<body>
    <!-- Print Controls -->
    <div class="print-controls no-print">
        <button onclick="window.print()" class="print-btn">üñ®Ô∏è Print Quotation</button>
        <a href="/quotations/<%= quotation.id %>" class="back-btn">‚Üê Back to Quotation</a>
    </div>

    <div class="invoice-container">
        <!-- Header -->
        <div class="invoice-header">
            <div class="company-name"><%= company.name %></div>
            <div class="company-details">
                <%= company.address.line1 %>, <%= company.address.line2 %><br>
                <%= company.address.city %>, <%= company.address.state %> - <%= company.address.pincode %><br>
                Cell: <%= company.contact.phone1 %>, <%= company.contact.phone2 %><br>
                GSTIN: <%= company.gst.gstin %>
            </div>
        </div>

        <!-- Title -->
        <div class="invoice-title">üíú QUOTATION</div>

        <!-- Validity Notice -->
        <% 
            const validUntil = new Date(quotation.validUntil);
            const isExpired = validUntil < new Date();
            const daysLeft = Math.ceil((validUntil - new Date()) / (1000 * 60 * 60 * 24));
        %>
        <% if (isExpired) { %>
            <div class="validity-notice expired-notice">
                ‚ö†Ô∏è This quotation expired on <%= validUntil.toLocaleDateString('en-IN') %>
            </div>
        <% } else if (daysLeft <= 7) { %>
            <div class="validity-notice">
                ‚è∞ This quotation expires on <%= validUntil.toLocaleDateString('en-IN') %> 
                (<%= daysLeft %> day<%= daysLeft !== 1 ? 's' : '' %> remaining)
            </div>
        <% } %>

        <!-- Quotation Details -->
        <div class="quotation-details">
            <div class="quotation-info">
                <div class="section-title">üíú Quotation Information</div>
                <div class="info-row">
                    <span class="info-label">Quotation Number:</span>
                    <span class="info-value"><%= quotation.quotationNumber %></span>
                </div>
                <div class="info-row">
                    <span class="info-label">Quotation Date:</span>
                    <span class="info-value"><%= new Date(quotation.quotationDate).toLocaleDateString('en-IN') %></span>
                </div>
                <div class="info-row">
                    <span class="info-label">Valid Until:</span>
                    <span class="info-value"><%= validUntil.toLocaleDateString('en-IN') %></span>
                </div>
                <div class="info-row">
                    <span class="info-label">Validity Days:</span>
                    <span class="info-value"><%= quotation.validityDays %> days</span>
                </div>
            </div>

            <div class="customer-info">
                <div class="section-title">üë§ Customer Information</div>
                <div class="info-row">
                    <span class="info-label">Name:</span>
                    <span class="info-value"><%= quotation.customerInfo.name %></span>
                </div>
                <% if (quotation.customerInfo.phone) { %>
                <div class="info-row">
                    <span class="info-label">Phone:</span>
                    <span class="info-value"><%= quotation.customerInfo.phone %></span>
                </div>
                <% } %>
                <% if (quotation.customerInfo.email) { %>
                <div class="info-row">
                    <span class="info-label">Email:</span>
                    <span class="info-value"><%= quotation.customerInfo.email %></span>
                </div>
                <% } %>
                <% if (quotation.customerInfo.gstin) { %>
                <div class="info-row">
                    <span class="info-label">GSTIN:</span>
                    <span class="info-value"><%= quotation.customerInfo.gstin %></span>
                </div>
                <% } %>
                <% if (quotation.customerInfo.address) { %>
                <div class="info-row">
                    <span class="info-label">Address:</span>
                    <span class="info-value"><%= quotation.customerInfo.address %></span>
                </div>
                <% } %>
            </div>
        </div>

        <!-- Items Section -->
        <div class="items-section">
            <h3 style="color: #8b5cf6; margin-bottom: 8px; font-size: 11px;">üì¶ Items</h3>
            <table class="items-table">
                <thead>
                    <tr>
                        <th style="width: 4%;">#</th>
                        <th style="width: 40%;">Item Details</th>
                        <th style="width: 8%;">HSN</th>
                        <th style="width: 8%;">Qty</th>
                        <th style="width: 8%;">Unit</th>
                        <th style="width: 15%;">Rate (‚Çπ)</th>
                        <th style="width: 15%;">Amount (‚Çπ)</th>
                    </tr>
                </thead>
                <tbody>
                    <% quotation.items.forEach((item, index) => { %>
                        <tr>
                            <td style="text-align: center;"><%= index + 1 %></td>
                            <td>
                                <div class="item-name"><%= item.itemName %></div>
                                <% if (item.description) { %>
                                    <div class="item-details">Description: <%= item.description %></div>
                                <% } %>
                            </td>
                            <td><%= item.hsnCode || 'N/A' %></td>
                            <td class="amount-column"><%= item.quantity %></td>
                            <td><%= item.unit || 'Pcs' %></td>
                            <td class="amount-column">‚Çπ<%= (item.rate || 0).toLocaleString('en-IN') %></td>
                            <td class="amount-column">‚Çπ<%= (item.total || 0).toLocaleString('en-IN') %></td>
                        </tr>
                    <% }) %>
                </tbody>
            </table>

            <!-- Extra Charges -->
            <% if (quotation.extraCharges && quotation.extraCharges.length > 0) { %>
                <div class="charges-section">
                    <h4 style="color: #8b5cf6; margin-bottom: 10px;">üí∞ Additional Charges</h4>
                    <table class="charges-table">
                        <thead>
                            <tr>
                                <th style="width: 5%;">#</th>
                                <th style="width: 70%;">Charge Description</th>
                                <th style="width: 25%;">Amount (‚Çπ)</th>
                            </tr>
                        </thead>
                        <tbody>
                            <% quotation.extraCharges.forEach((charge, index) => { %>
                                <tr>
                                    <td><%= index + 1 %></td>
                                    <td><%= charge.description %></td>
                                    <td class="amount-column">‚Çπ<%= (charge.amount || 0).toLocaleString('en-IN') %></td>
                                </tr>
                            <% }) %>
                        </tbody>
                    </table>
                </div>
            <% } %>
        </div>

        <!-- Totals Section -->
        <div class="totals-section">
            <table class="totals-table">
                <tr>
                    <td class="total-label">Subtotal:</td>
                    <td class="total-amount">‚Çπ<%= (quotation.subtotal || 0).toLocaleString('en-IN') %></td>
                </tr>
                <% if (quotation.cgstAmount > 0) { %>
                <tr>
                    <td class="total-label">CGST (9%):</td>
                    <td class="total-amount">‚Çπ<%= (quotation.cgstAmount || 0).toLocaleString('en-IN') %></td>
                </tr>
                <tr>
                    <td class="total-label">SGST (9%):</td>
                    <td class="total-amount">‚Çπ<%= (quotation.sgstAmount || 0).toLocaleString('en-IN') %></td>
                </tr>
                <% } %>
                
                <!-- Round Off Section -->
                <% if (quotation.roundOffEnabled !== false) { %>
                    <% const totalBeforeRoundOff = quotation.totalBeforeRoundOff || (quotation.subtotal + (quotation.cgstAmount || 0) + (quotation.sgstAmount || 0)); %>
                    <tr>
                        <td class="total-label">Total Before Round Off:</td>
                        <td class="total-amount">‚Çπ<%= totalBeforeRoundOff.toLocaleString('en-IN') %></td>
                    </tr>
                    
                    <% const roundOffAmount = quotation.roundOffAmount || 0; %>
                    <tr>
                        <td class="total-label">Round Off:</td>
                        <td class="total-amount <% if (roundOffAmount >= 0) { %>text-success<% } else { %>text-danger<% } %>">
                            <%= roundOffAmount >= 0 ? '+' : '' %>‚Çπ<%= Math.abs(roundOffAmount).toLocaleString('en-IN') %>
                        </td>
                    </tr>
                <% } %>
                
                <tr class="final-total">
                    <td>Total Amount:</td>
                    <td>‚Çπ<%= (quotation.finalTotal || 0).toLocaleString('en-IN') %></td>
                </tr>
            </table>
        </div>

        <!-- Terms and Conditions -->
        <div class="terms-section">
            <div class="terms-title">üìã Terms & Conditions:</div>
            <div class="terms-content">
                1. This quotation is valid for <%= quotation.validityDays %> days from the date of issue.<br>
                2. Prices are subject to change without prior notice after the validity period.<br>
                3. This is a quotation only and not an invoice. No payment is due until order confirmation.<br>
                4. Goods once sold will not be taken back or exchanged.<br>
                5. All disputes are subject to <%= company.address.city %> jurisdiction only.<br>
                6. Payment terms will be as per agreed terms during order placement.<br>
                7. Delivery terms and charges will be discussed during order confirmation.
            </div>
        </div>

        <!-- Footer -->
        <div class="footer-section">
            <p style="margin: 0; color: #666; font-size: 12px;">
                This is a computer-generated quotation and does not require a physical signature.
            </p>
            
            <div class="signature-area">
                <div class="signature-box">
                    <strong>Customer Acknowledgment</strong><br>
                    <small>Date & Signature</small>
                </div>
                <div class="signature-box">
                    <strong>For <%= company.name %></strong><br>
                    <small>Authorized Signatory</small>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Auto-print functionality
        window.addEventListener('load', function() {
            // Check if print parameter is in URL
            const urlParams = new URLSearchParams(window.location.search);
            if (urlParams.get('print') === 'true') {
                setTimeout(() => {
                    window.print();
                }, 500);
            }
        });
    </script>
</body>
</html>
