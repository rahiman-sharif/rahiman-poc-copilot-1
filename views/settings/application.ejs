<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Application Settings - <%= companyName %></title>
    <link rel="stylesheet" href="/css/style.css">
</head>
<body>
    <!-- Header -->
    <header class="main-header">
        <div class="header-content">
            <div class="logo-section">
                <h1>üè¢ <%= companyName %></h1>
                <p>Application Settings</p>
            </div>
            
            <div class="user-section">
                <div class="user-info">
                    <span class="user-name">Welcome, <%= user.name %></span>
                    <span class="user-role">(<%= user.role %>)</span>
                </div>
                <form action="/logout" method="POST" style="display: inline;">
                    <button type="submit" class="logout-btn">Logout</button>
                </form>
            </div>
        </div>
    </header>

    <!-- Navigation -->
    <nav class="breadcrumb">
        <div class="breadcrumb-content">
            <a href="/dashboard">üè† Dashboard</a>
            <span class="separator">></span>
            <a href="/settings">‚öôÔ∏è Settings</a>
            <span class="separator">></span>
            <span class="current">üîß Application</span>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="items-main">
        <div class="items-container">
            <!-- Page Header -->
            <div class="page-header">
                <div class="header-left">
                    <h2>üîß Application Settings</h2>
                    <p>Configure application behavior, performance and general preferences</p>
                </div>
                <div class="header-right">
                    <a href="/settings" class="btn btn-secondary">‚Üê Back to Settings</a>
                </div>
            </div>

            <!-- Alert Messages -->
            <% if (typeof query !== 'undefined' && query.success) { %>
                <div class="alert alert-success">
                    <%= query.success %>
                </div>
            <% } %>
            <% if (typeof query !== 'undefined' && query.error) { %>
                <div class="alert alert-danger">
                    <%= query.error %>
                </div>
            <% } %>

            <!-- Application Settings Form -->
            <div class="form-container">
                <form action="/settings/application" method="POST" class="settings-form">
                    <!-- General Settings -->
                    <div class="form-section">
                        <h3>‚öôÔ∏è General Settings</h3>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="appName">Application Name</label>
                                <input type="text" id="appName" name="appName" 
                                       value="<%= settings.application?.name || companyName + ' Billing System' %>" 
                                       required>
                            </div>
                            
                            <div class="form-group">
                                <label for="appVersion">Application Version</label>
                                <input type="text" id="appVersion" name="appVersion" 
                                       value="<%= settings.application?.version || '1.0.0' %>" 
                                       readonly>
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label for="defaultLanguage">Default Language</label>
                                <select id="defaultLanguage" name="defaultLanguage" required>
                                    <option value="en" <%= settings.application?.language === 'en' ? 'selected' : '' %>>English</option>
                                    <option value="hi" <%= settings.application?.language === 'hi' ? 'selected' : '' %>>‡§π‡§ø‡§Ç‡§¶‡•Ä (Hindi)</option>
                                    <option value="mr" <%= settings.application?.language === 'mr' ? 'selected' : '' %>>‡§Æ‡§∞‡§æ‡§†‡•Ä (Marathi)</option>
                                    <option value="gu" <%= settings.application?.language === 'gu' ? 'selected' : '' %>>‡™ó‡´Å‡™ú‡™∞‡™æ‡™§‡´Ä (Gujarati)</option>
                                    <option value="te" <%= settings.application?.language === 'te' ? 'selected' : '' %>>‡∞§‡±Ü‡∞≤‡±Å‡∞ó‡±Å (Telugu)</option>
                                    <option value="ta" <%= settings.application?.language === 'ta' ? 'selected' : '' %>>‡Æ§‡ÆÆ‡Æø‡Æ¥‡Øç (Tamil)</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label for="dateFormat">Date Format</label>
                                <select id="dateFormat" name="dateFormat" required>
                                    <option value="DD/MM/YYYY" <%= settings.application?.dateFormat === 'DD/MM/YYYY' ? 'selected' : '' %>>DD/MM/YYYY (Indian)</option>
                                    <option value="MM/DD/YYYY" <%= settings.application?.dateFormat === 'MM/DD/YYYY' ? 'selected' : '' %>>MM/DD/YYYY (US)</option>
                                    <option value="YYYY-MM-DD" <%= settings.application?.dateFormat === 'YYYY-MM-DD' ? 'selected' : '' %>>YYYY-MM-DD (ISO)</option>
                                    <option value="DD-MM-YYYY" <%= settings.application?.dateFormat === 'DD-MM-YYYY' ? 'selected' : '' %>>DD-MM-YYYY</option>
                                </select>
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label for="timeFormat">Time Format</label>
                                <select id="timeFormat" name="timeFormat" required>
                                    <option value="12" <%= settings.application?.timeFormat === '12' ? 'selected' : '' %>>12-hour (AM/PM)</option>
                                    <option value="24" <%= settings.application?.timeFormat === '24' ? 'selected' : '' %>>24-hour</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label for="timezone">Timezone</label>
                                <select id="timezone" name="timezone" required>
                                    <option value="Asia/Kolkata" <%= settings.application?.timezone === 'Asia/Kolkata' ? 'selected' : '' %>>Asia/Kolkata (IST)</option>
                                    <option value="Asia/Mumbai" <%= settings.application?.timezone === 'Asia/Mumbai' ? 'selected' : '' %>>Asia/Mumbai (IST)</option>
                                    <option value="Asia/Delhi" <%= settings.application?.timezone === 'Asia/Delhi' ? 'selected' : '' %>>Asia/Delhi (IST)</option>
                                    <option value="UTC" <%= settings.application?.timezone === 'UTC' ? 'selected' : '' %>>UTC</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- Performance Settings -->
                    <div class="form-section">
                        <h3>‚ö° Performance Settings</h3>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="pageSize">Records Per Page</label>
                                <select id="pageSize" name="pageSize" required>
                                    <option value="10" <%= settings.application?.pageSize === 10 ? 'selected' : '' %>>10 records</option>
                                    <option value="25" <%= settings.application?.pageSize === 25 ? 'selected' : '' %>>25 records</option>
                                    <option value="50" <%= settings.application?.pageSize === 50 ? 'selected' : '' %>>50 records</option>
                                    <option value="100" <%= settings.application?.pageSize === 100 ? 'selected' : '' %>>100 records</option>
                                </select>
                                <small class="help-text">Number of records to display per page in lists</small>
                            </div>
                            
                            <div class="form-group">
                                <label for="cacheTimeout">Cache Timeout (minutes)</label>
                                <select id="cacheTimeout" name="cacheTimeout" required>
                                    <option value="5" <%= settings.application?.cacheTimeout === 5 ? 'selected' : '' %>>5 minutes</option>
                                    <option value="15" <%= settings.application?.cacheTimeout === 15 ? 'selected' : '' %>>15 minutes</option>
                                    <option value="30" <%= settings.application?.cacheTimeout === 30 ? 'selected' : '' %>>30 minutes</option>
                                    <option value="60" <%= settings.application?.cacheTimeout === 60 ? 'selected' : '' %>>1 hour</option>
                                </select>
                                <small class="help-text">How long to cache data for better performance</small>
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label for="enableLazyLoading">Enable Lazy Loading</label>
                                <div class="checkbox-group">
                                    <input type="checkbox" id="enableLazyLoading" name="enableLazyLoading" 
                                           <%= settings.application?.enableLazyLoading !== false ? 'checked' : '' %>>
                                    <span class="checkmark"></span>
                                    <span>Load content as needed to improve page speed</span>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label for="enableCompression">Enable Data Compression</label>
                                <div class="checkbox-group">
                                    <input type="checkbox" id="enableCompression" name="enableCompression" 
                                           <%= settings.application?.enableCompression !== false ? 'checked' : '' %>>
                                    <span class="checkmark"></span>
                                    <span>Compress data to reduce storage space</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- User Interface Settings -->
                    <div class="form-section">
                        <h3>üé® User Interface Settings</h3>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="theme">Application Theme</label>
                                <select id="theme" name="theme" required>
                                    <option value="light" <%= settings.application?.theme === 'light' ? 'selected' : '' %>>Light Theme</option>
                                    <option value="dark" <%= settings.application?.theme === 'dark' ? 'selected' : '' %>>Dark Theme</option>
                                    <option value="auto" <%= settings.application?.theme === 'auto' ? 'selected' : '' %>>Auto (System)</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label for="fontSize">Font Size</label>
                                <select id="fontSize" name="fontSize" required>
                                    <option value="small" <%= settings.application?.fontSize === 'small' ? 'selected' : '' %>>Small</option>
                                    <option value="medium" <%= settings.application?.fontSize === 'medium' ? 'selected' : '' %>>Medium</option>
                                    <option value="large" <%= settings.application?.fontSize === 'large' ? 'selected' : '' %>>Large</option>
                                    <option value="extra-large" <%= settings.application?.fontSize === 'extra-large' ? 'selected' : '' %>>Extra Large</option>
                                </select>
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label for="enableAnimations">Enable Animations</label>
                                <div class="checkbox-group">
                                    <input type="checkbox" id="enableAnimations" name="enableAnimations" 
                                           <%= settings.application?.enableAnimations !== false ? 'checked' : '' %>>
                                    <span class="checkmark"></span>
                                    <span>Show smooth transitions and animations</span>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label for="enableSounds">Enable Sound Effects</label>
                                <div class="checkbox-group">
                                    <input type="checkbox" id="enableSounds" name="enableSounds" 
                                           <%= settings.application?.enableSounds ? 'checked' : '' %>>
                                    <span class="checkmark"></span>
                                    <span>Play sounds for notifications and actions</span>
                                </div>
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label for="sidebarCollapsed">Sidebar Default State</label>
                                <select id="sidebarCollapsed" name="sidebarCollapsed" required>
                                    <option value="expanded" <%= settings.application?.sidebarCollapsed === 'expanded' ? 'selected' : '' %>>Expanded</option>
                                    <option value="collapsed" <%= settings.application?.sidebarCollapsed === 'collapsed' ? 'selected' : '' %>>Collapsed</option>
                                    <option value="auto" <%= settings.application?.sidebarCollapsed === 'auto' ? 'selected' : '' %>>Auto (Based on screen size)</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label for="tableRowHeight">Table Row Height</label>
                                <select id="tableRowHeight" name="tableRowHeight" required>
                                    <option value="compact" <%= settings.application?.tableRowHeight === 'compact' ? 'selected' : '' %>>Compact</option>
                                    <option value="normal" <%= settings.application?.tableRowHeight === 'normal' ? 'selected' : '' %>>Normal</option>
                                    <option value="comfortable" <%= settings.application?.tableRowHeight === 'comfortable' ? 'selected' : '' %>>Comfortable</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- Notification Settings -->
                    <div class="form-section">
                        <h3>üîî Notification Settings</h3>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="enableNotifications">Enable Notifications</label>
                                <div class="checkbox-group">
                                    <input type="checkbox" id="enableNotifications" name="enableNotifications" 
                                           <%= settings.application?.enableNotifications !== false ? 'checked' : '' %>>
                                    <span class="checkmark"></span>
                                    <span>Show system notifications</span>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label for="notificationDuration">Notification Duration (seconds)</label>
                                <select id="notificationDuration" name="notificationDuration" required>
                                    <option value="3" <%= settings.application?.notificationDuration === 3 ? 'selected' : '' %>>3 seconds</option>
                                    <option value="5" <%= settings.application?.notificationDuration === 5 ? 'selected' : '' %>>5 seconds</option>
                                    <option value="10" <%= settings.application?.notificationDuration === 10 ? 'selected' : '' %>>10 seconds</option>
                                    <option value="0" <%= settings.application?.notificationDuration === 0 ? 'selected' : '' %>>Manual dismiss</option>
                                </select>
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label for="notificationPosition">Notification Position</label>
                                <select id="notificationPosition" name="notificationPosition" required>
                                    <option value="top-right" <%= settings.application?.notificationPosition === 'top-right' ? 'selected' : '' %>>Top Right</option>
                                    <option value="top-left" <%= settings.application?.notificationPosition === 'top-left' ? 'selected' : '' %>>Top Left</option>
                                    <option value="bottom-right" <%= settings.application?.notificationPosition === 'bottom-right' ? 'selected' : '' %>>Bottom Right</option>
                                    <option value="bottom-left" <%= settings.application?.notificationPosition === 'bottom-left' ? 'selected' : '' %>>Bottom Left</option>
                                    <option value="top-center" <%= settings.application?.notificationPosition === 'top-center' ? 'selected' : '' %>>Top Center</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label for="enableBrowserNotifications">Enable Browser Notifications</label>
                                <div class="checkbox-group">
                                    <input type="checkbox" id="enableBrowserNotifications" name="enableBrowserNotifications" 
                                           <%= settings.application?.enableBrowserNotifications ? 'checked' : '' %>>
                                    <span class="checkmark"></span>
                                    <span>Show notifications even when app is not active</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Backup & Maintenance -->
                    <div class="form-section">
                        <h3>üõ†Ô∏è Backup & Maintenance</h3>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="autoBackup">Enable Auto Backup</label>
                                <div class="checkbox-group">
                                    <input type="checkbox" id="autoBackup" name="autoBackup" 
                                           <%= settings.application?.autoBackup !== false ? 'checked' : '' %>>
                                    <span class="checkmark"></span>
                                    <span>Automatically backup data periodically</span>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label for="backupFrequency">Backup Frequency</label>
                                <select id="backupFrequency" name="backupFrequency" required>
                                    <option value="daily" <%= settings.application?.backupFrequency === 'daily' ? 'selected' : '' %>>Daily</option>
                                    <option value="weekly" <%= settings.application?.backupFrequency === 'weekly' ? 'selected' : '' %>>Weekly</option>
                                    <option value="monthly" <%= settings.application?.backupFrequency === 'monthly' ? 'selected' : '' %>>Monthly</option>
                                </select>
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label for="maxBackupFiles">Max Backup Files to Keep</label>
                                <select id="maxBackupFiles" name="maxBackupFiles" required>
                                    <option value="5" <%= settings.application?.maxBackupFiles === 5 ? 'selected' : '' %>>5 files</option>
                                    <option value="10" <%= settings.application?.maxBackupFiles === 10 ? 'selected' : '' %>>10 files</option>
                                    <option value="20" <%= settings.application?.maxBackupFiles === 20 ? 'selected' : '' %>>20 files</option>
                                    <option value="50" <%= settings.application?.maxBackupFiles === 50 ? 'selected' : '' %>>50 files</option>
                                </select>
                                <small class="help-text">Older backup files will be automatically deleted</small>
                            </div>
                            
                            <div class="form-group">
                                <label for="maintenanceMode">Maintenance Mode</label>
                                <div class="checkbox-group">
                                    <input type="checkbox" id="maintenanceMode" name="maintenanceMode" 
                                           <%= settings.application?.maintenanceMode ? 'checked' : '' %>>
                                    <span class="checkmark"></span>
                                    <span>Enable maintenance mode (blocks non-admin access)</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- System Information -->
                    <div class="form-section">
                        <h3>‚ÑπÔ∏è System Information</h3>
                        
                        <div class="system-info-grid">
                            <div class="info-card">
                                <div class="info-header">
                                    <span class="info-icon">üñ•Ô∏è</span>
                                    <h4>System</h4>
                                </div>
                                <div class="info-content">
                                    <div class="info-item">
                                        <span class="label">Operating System:</span>
                                        <span class="value">Windows 11</span>
                                    </div>
                                    <div class="info-item">
                                        <span class="label">Node.js Version:</span>
                                        <span class="value">v18.17.0</span>
                                    </div>
                                    <div class="info-item">
                                        <span class="label">Application Version:</span>
                                        <span class="value">1.0.0</span>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="info-card">
                                <div class="info-header">
                                    <span class="info-icon">üíæ</span>
                                    <h4>Storage</h4>
                                </div>
                                <div class="info-content">
                                    <div class="info-item">
                                        <span class="label">Database Size:</span>
                                        <span class="value">2.4 MB</span>
                                    </div>
                                    <div class="info-item">
                                        <span class="label">Backup Size:</span>
                                        <span class="value">15.6 MB</span>
                                    </div>
                                    <div class="info-item">
                                        <span class="label">Total Records:</span>
                                        <span class="value">247</span>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="info-card">
                                <div class="info-header">
                                    <span class="info-icon">üìä</span>
                                    <h4>Usage</h4>
                                </div>
                                <div class="info-content">
                                    <div class="info-item">
                                        <span class="label">Total Bills:</span>
                                        <span class="value">1,024</span>
                                    </div>
                                    <div class="info-item">
                                        <span class="label">Active Users:</span>
                                        <span class="value">3</span>
                                    </div>
                                    <div class="info-item">
                                        <span class="label">Last Backup:</span>
                                        <span class="value">2 hours ago</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Action Buttons -->
                    <div class="form-actions">
                        <button type="submit" class="btn btn-primary">üíæ Save Application Settings</button>
                        <a href="/settings" class="btn btn-secondary">Cancel</a>
                        <button type="button" onclick="clearCache()" class="btn btn-warning">üóëÔ∏è Clear Cache</button>
                        <button type="button" onclick="restartApp()" class="btn btn-danger">üîÑ Restart Application</button>
                    </div>
                </form>
            </div>
        </div>
    </main>

    <!-- JavaScript -->
    <script>
        // Auto-hide alerts
        setTimeout(() => {
            const alerts = document.querySelectorAll('.alert');
            alerts.forEach(alert => {
                alert.style.opacity = '0';
                setTimeout(() => alert.remove(), 300);
            });
        }, 5000);

        // Clear cache function
        function clearCache() {
            if (confirm('Are you sure you want to clear the application cache? This may temporarily slow down the application.')) {
                // Simulate cache clearing
                const btn = event.target;
                const originalText = btn.textContent;
                btn.textContent = 'üîÑ Clearing...';
                btn.disabled = true;
                
                setTimeout(() => {
                    btn.textContent = originalText;
                    btn.disabled = false;
                    alert('Cache cleared successfully!');
                }, 2000);
            }
        }

        // Restart application function
        function restartApp() {
            if (confirm('Are you sure you want to restart the application? All users will be logged out and there may be a brief downtime.')) {
                const btn = event.target;
                btn.textContent = 'üîÑ Restarting...';
                btn.disabled = true;
                
                // In a real implementation, this would send a restart signal to the server
                setTimeout(() => {
                    alert('Application restart initiated. Please wait a moment and refresh the page.');
                    window.location.reload();
                }, 3000);
            }
        }

        // Update theme preview
        document.getElementById('theme').addEventListener('change', function() {
            const theme = this.value;
            if (theme === 'dark') {
                document.body.style.filter = 'invert(1) hue-rotate(180deg)';
            } else {
                document.body.style.filter = '';
            }
        });

        // Update font size preview
        document.getElementById('fontSize').addEventListener('change', function() {
            const fontSize = this.value;
            const body = document.body;
            body.classList.remove('font-small', 'font-medium', 'font-large', 'font-extra-large');
            body.classList.add('font-' + fontSize);
        });

        // Request browser notification permission
        document.getElementById('enableBrowserNotifications').addEventListener('change', function() {
            if (this.checked && 'Notification' in window) {
                if (Notification.permission === 'default') {
                    Notification.requestPermission().then(permission => {
                        if (permission !== 'granted') {
                            this.checked = false;
                            alert('Browser notifications were denied. Please enable them in your browser settings.');
                        }
                    });
                }
            }
        });
    </script>

    <style>
        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .checkbox-group input[type="checkbox"] {
            width: auto;
            margin: 0;
        }

        .help-text {
            display: block;
            margin-top: 5px;
            color: #666;
            font-size: 12px;
        }

        .system-info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .info-card {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 20px;
        }

        .info-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
        }

        .info-icon {
            font-size: 1.5em;
        }

        .info-header h4 {
            margin: 0;
            color: #333;
        }

        .info-content {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .info-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 5px 0;
            border-bottom: 1px solid #eee;
        }

        .info-item:last-child {
            border-bottom: none;
        }

        .label {
            font-weight: 500;
            color: #666;
        }

        .value {
            font-weight: bold;
            color: #333;
        }

        .form-section {
            margin-bottom: 30px;
        }

        .form-section h3 {
            color: var(--primary-color);
            border-bottom: 2px solid #e9ecef;
            padding-bottom: 10px;
            margin-bottom: 20px;
        }

        .form-actions {
            display: flex;
            gap: 15px;
            justify-content: flex-start;
            margin-top: 30px;
            padding: 20px 0;
            border-top: 2px solid #e9ecef;
        }

        /* Font size classes for preview */
        .font-small { font-size: 14px; }
        .font-medium { font-size: 16px; }
        .font-large { font-size: 18px; }
        .font-extra-large { font-size: 20px; }
    </style>
</body>
</html>
