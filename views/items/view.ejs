<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title><%= title %></title>
    <link rel="stylesheet" href="/css/style.css">
</head>
<body>
    <!-- Header -->
    <header class="main-header">
        <div class="header-content">
            <div class="logo-section">
                <a href="/dashboard" style="text-decoration: none; color: inherit;">
                    <h1>üè¢ <%= companyName %></h1>
                    <p>Item Details</p>
                </a>
            </div>
            
            <div class="user-section">
                <div class="user-info">
                    <span class="user-name">Welcome, <%= user.name %></span>
                    <span class="user-role">(<%= user.role %>)</span>
                </div>
                <form action="/logout" method="POST" style="display: inline;">
                    <button type="submit" class="logout-btn">Logout</button>
                </form>
            </div>
        </div>
    </header>

    <!-- Navigation -->
    <nav class="breadcrumb">
        <div class="breadcrumb-content">
            <a href="/dashboard">üè† Dashboard</a>
            <span class="separator">></span>
            <a href="/items">üì¶ Items</a>
            <span class="separator">></span>
            <span class="current">üëÅÔ∏è <%= item.name %></span>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="main-content">
        <div class="content-wrapper">
            <!-- Page Header -->
            <div class="page-header">
                <div class="header-left">
                    <h2>üì¶ <%= item.name %></h2>
                    <p>Item details and stock information</p>
                </div>
                <div class="header-right">
                    <a href="/items" class="btn btn-secondary">
                        <span class="btn-icon">‚Üê</span>
                        Back to Items
                    </a>
                    <button onclick="refreshPage()" class="btn btn-info">
                        <span class="btn-icon">üîÑ</span>
                        Refresh Data
                    </button>
                    <% if (user.role === 'admin') { %>
                        <a href="/items/<%= item.id %>/edit" class="btn btn-primary">
                            <span class="btn-icon">‚úèÔ∏è</span>
                            Edit Item
                        </a>
                    <% } %>
                    <% if (!item.isServiceItem) { %>
                        <a href="/stock/adjust/<%= item.id %>" class="btn btn-warning">
                            <span class="btn-icon">üîß</span>
                            Adjust Stock
                        </a>
                    <% } %>
                </div>
            </div>

            <!-- Alert Messages -->
            <% if (typeof query !== 'undefined' && query.success) { %>
                <div class="alert alert-success">
                    <%= query.success %>
                </div>
            <% } %>
            <% if (typeof query !== 'undefined' && query.error) { %>
                <div class="alert alert-error">
                    <%= query.error %>
                </div>
            <% } %>

            <!-- Item Details -->
            <div class="item-details-container">
                <!-- Basic Information -->
                <div class="details-card">
                    <div class="card-header">
                        <h3>üìã Basic Information</h3>
                        <% if (item.isServiceItem) { %>
                            <span class="service-badge">üîß Service Item</span>
                        <% } else { %>
                            <span class="product-badge">üì¶ Product Item</span>
                        <% } %>
                    </div>
                    <div class="card-content">
                        <div class="details-grid">
                            <div class="detail-item">
                                <label>Item Name:</label>
                                <strong><%= item.name %></strong>
                            </div>
                            <div class="detail-item">
                                <label>Category:</label>
                                <span><%= item.categoryName %></span>
                            </div>
                            <div class="detail-item">
                                <label>Brand:</label>
                                <span><%= item.brand || 'N/A' %></span>
                            </div>
                            <div class="detail-item">
                                <label>Unit:</label>
                                <span><%= item.unit %></span>
                            </div>
                            <div class="detail-item">
                                <label>HSN Code:</label>
                                <span><%= item.hsnCode %></span>
                            </div>
                            <div class="detail-item">
                                <label>GST Rate:</label>
                                <span><%= item.gstRate %>%</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Pricing Information -->
                <div class="details-card">
                    <div class="card-header">
                        <h3>üí∞ Pricing Information</h3>
                    </div>
                    <div class="card-content">
                        <div class="details-grid">
                            <div class="detail-item">
                                <label>Price per <%= item.unit %>:</label>
                                <strong class="price-highlight">‚Çπ<%= item.price.toFixed(2) %></strong>
                            </div>
                            <div class="detail-item">
                                <label>Price Editable at Billing:</label>
                                <span class="<%= item.priceEditableAtBilling ? 'yes' : 'no' %>">
                                    <%= item.priceEditableAtBilling ? '‚úÖ Yes' : '‚ùå No' %>
                                </span>
                            </div>
                            <div class="detail-item">
                                <label>Taxable:</label>
                                <span class="<%= item.isTaxable ? 'yes' : 'no' %>">
                                    <%= item.isTaxable ? '‚úÖ Yes' : '‚ùå No' %>
                                </span>
                            </div>
                        </div>
                    </div>
                </div>

                <% if (!item.isServiceItem) { %>
                <!-- Stock Information -->
                <div class="details-card">
                    <div class="card-header">
                        <h3>üìä Stock Information</h3>
                        <span class="stock-status-badge status-<%= item.stock.quantity === 0 ? 'out-of-stock' : item.stock.quantity <= item.stock.minLevel ? 'low-stock' : 'in-stock' %>">
                            <% if (item.stock.quantity === 0) { %>
                                ‚ùå Out of Stock
                            <% } else if (item.stock.quantity <= item.stock.minLevel) { %>
                                ‚ö†Ô∏è Low Stock
                            <% } else { %>
                                ‚úÖ In Stock
                            <% } %>
                        </span>
                    </div>
                    <div class="card-content">
                        <div class="details-grid">
                            <div class="detail-item">
                                <label>Current Stock:</label>
                                <strong class="stock-highlight"><%= item.stock.quantity %> <%= item.unit %></strong>
                                <!-- Debug info -->
                                <div style="font-size: 10px; color: #666; margin-top: 5px;">                                    
                                </div>
                            </div>
                            <div class="detail-item">
                                <label>Minimum Level:</label>
                                <span><%= item.stock.minLevel %> <%= item.unit %></span>
                            </div>
                            <div class="detail-item">
                                <label>Stock Value:</label>
                                <span>‚Çπ<%= (item.stock.quantity * item.price).toLocaleString('en-IN') %></span>
                            </div>
                            <% if (item.bundleInfo) { %>
                                <div class="detail-item">
                                    <label>Bundle Information:</label>
                                    <span class="bundle-info"><%= item.bundleInfo %></span>
                                </div>
                                <% 
                                    const bundleQuantity = item.bundleInfo ? parseFloat(item.bundleInfo.match(/(\d+\.?\d*)/)?.[1] || 0) : 0;
                                    const totalBundles = bundleQuantity > 0 ? Math.floor(item.stock.quantity / bundleQuantity) : 0;
                                %>
                                <% if (bundleQuantity > 0) { %>
                                    <div class="detail-item">
                                        <label>Total Bundles:</label>
                                        <span><%= totalBundles %> bundles</span>
                                    </div>
                                <% } %>
                            <% } %>
                        </div>
                    </div>
                </div>
                <% } %>

                <!-- Additional Information -->
                <div class="details-card">
                    <div class="card-header">
                        <h3>‚ÑπÔ∏è Additional Information</h3>
                    </div>
                    <div class="card-content">
                        <div class="details-grid">
                            <div class="detail-item">
                                <label>Status:</label>
                                <span class="<%= item.isActive ? 'active' : 'inactive' %>">
                                    <%= item.isActive ? '‚úÖ Active' : '‚ùå Inactive' %>
                                </span>
                            </div>
                            <div class="detail-item">
                                <label>Created:</label>
                                <span><%= new Date(item.createdAt).toLocaleDateString('en-IN') %></span>
                            </div>
                            <% if (item.updatedAt) { %>
                                <div class="detail-item">
                                    <label>Last Updated:</label>
                                    <span><%= new Date(item.updatedAt).toLocaleDateString('en-IN') %></span>
                                </div>
                            <% } %>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- JavaScript -->
    <script>
        // Auto-hide alerts
        setTimeout(() => {
            const alerts = document.querySelectorAll('.alert');
            alerts.forEach(alert => {
                alert.style.opacity = '0';
                setTimeout(() => alert.remove(), 300);
            });
        }, 5000);
    </script>

    <style>
        .item-details-container {
            display: grid;
            gap: 20px;
            max-width: 1000px;
        }

        .details-card {
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 30px;
            background: #f8f9fa;
            border-bottom: 1px solid #e9ecef;
        }

        .card-header h3 {
            margin: 0;
            color: #495057;
        }

        .service-badge {
            background: #e3f2fd;
            color: #1565c0;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
        }

        .product-badge {
            background: #e8f5e8;
            color: #2e7d32;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
        }

        .stock-status-badge {
            padding: 6px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
        }

        .card-content {
            padding: 30px;
        }

        .details-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }

        .detail-item {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .detail-item label {
            font-size: 12px;
            color: #6c757d;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            font-weight: 600;
        }

        .price-highlight {
            font-size: 18px;
            color: #28a745;
        }

        .stock-highlight {
            font-size: 18px;
            color: #007bff;
        }

        .bundle-info {
            font-style: italic;
            color: #6c757d;
        }

        .yes {
            color: #28a745;
        }

        .no {
            color: #dc3545;
        }

        .active {
            color: #28a745;
        }

        .inactive {
            color: #dc3545;
        }
    </style>
    
    <!-- JavaScript for refresh functionality -->
    <script>
        function refreshPage() {
            // Add cache-busting parameter to force refresh
            const url = new URL(window.location);
            url.searchParams.set('_t', Date.now());
            window.location.href = url.toString();
        }
    </script>
</body>
</html>
